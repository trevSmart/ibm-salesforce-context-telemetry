{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Telemetry Event Schema",
  "description": "JSON schema for telemetry events sent to the telemetry server",
  "type": "object",
  "required": ["event", "timestamp"],
  "properties": {
    "event": {
      "type": "string",
      "enum": [
        "tool_call",
        "tool_error",
        "session_start",
        "session_end",
        "error",
        "custom"
      ],
      "description": "Type of telemetry event"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the event occurred"
    },
    "serverId": {
      "type": "string",
      "description": "Unique identifier for the MCP server instance"
    },
    "version": {
      "type": "string",
      "description": "Version of the MCP server"
    },
    "sessionId": {
      "type": "string",
      "description": "Unique identifier for the MCP session"
    },
    "userId": {
      "type": "string",
      "description": "Anonymous user identifier (no PII should be included)"
    },
    "data": {
      "type": "object",
      "description": "Event-specific data payload",
      "additionalProperties": true,
      "properties": {
        "toolName": {
          "type": "string",
          "description": "Name of the tool that was called"
        },
        "success": {
          "type": "boolean",
          "description": "Whether the operation was successful"
        },
        "duration": {
          "type": "integer",
          "description": "Duration of the operation in milliseconds",
          "minimum": 0
        },
        "operation": {
          "type": "string",
          "description": "Type of operation (e.g., 'query', 'create', 'update')"
        },
        "errorType": {
          "type": "string",
          "description": "Type of error (if applicable)"
        },
        "errorMessage": {
          "type": "string",
          "description": "Error message (if applicable, should not contain sensitive data)"
        },
        "paramsCount": {
          "type": "integer",
          "description": "Number of parameters passed",
          "minimum": 0
        },
        "transport": {
          "type": "string",
          "enum": ["stdio", "http"],
          "description": "Transport type used by the MCP server"
        },
        "clientVersion": {
          "type": "string",
          "description": "Version of the MCP client"
        },
        "toolCallsCount": {
          "type": "integer",
          "description": "Total number of tool calls in session",
          "minimum": 0
        }
      }
    }
  },
  "additionalProperties": true,
  "examples": [
    {
      "event": "tool_call",
      "timestamp": "2024-01-15T10:30:00.000Z",
      "serverId": "server-instance-123",
      "version": "1.0.0",
      "data": {
        "toolName": "execute_queries_and_dml",
        "operation": "query",
        "duration": 150,
        "success": true
      }
    },
    {
      "event": "tool_error",
      "timestamp": "2024-01-15T10:30:00.000Z",
      "serverId": "server-instance-123",
      "version": "1.0.0",
      "data": {
        "toolName": "describe_object",
        "errorType": "ValidationError",
        "errorMessage": "Invalid object name",
        "success": false
      }
    },
    {
      "event": "session_start",
      "timestamp": "2024-01-15T10:30:00.000Z",
      "serverId": "server-instance-123",
      "version": "1.0.0",
      "data": {
        "transport": "stdio",
        "clientVersion": "1.0.0"
      }
    }
  ]
}
