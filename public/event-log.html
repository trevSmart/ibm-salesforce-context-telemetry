<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon.png">
	<link href="/css/output.css" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script>
		// Apply theme immediately before page render to prevent flash
		(function() {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || 'dark';
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make body visible here - wait for chart to render
			// The body will be made visible when chartRenderComplete event fires
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const mainContainer = document.querySelector('.main-container');
				if (mainContainer) {
					const computedStyle = window.getComputedStyle(mainContainer);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						mainContainer.style.visibility = 'visible';
						requestAnimationFrame(() => {
							mainContainer.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
</head>
<body class="event-log-page">
	<div class="main-container">
		<div class="content-wrapper">
			<div class="sidebar">
				<div class="sidebar-header">
					<div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
						<a href="/" class="back-link subtitle">← Back to Dashboard</a>
					</div>
					<div class="log-viewer-title font-semibold">Event logs</div>
				</div>
				<div class="sidebar-content">
					<div class="tabs-container">
						<button class="tab-btn active" id="sessionsTab" data-tab="sessions">
							<span class="text-xs font-semibold uppercase tracking-wider">Sessions</span>
						</button>
						<button class="tab-btn" id="usersTab" data-tab="users">
							<span class="text-xs font-semibold uppercase tracking-wider">Users</span>
						</button>
						<button class="tab-btn" id="teamsTab" data-tab="teams">
							<span class="text-xs font-semibold uppercase tracking-wider">Teams</span>
						</button>
						<div class="tab-indicator" id="tabIndicator"></div>
					</div>
					<div class="all-sessions-container" id="sessionsContainer">
						<ul class="session-list list-none">
							<li class="session-item active" data-session="all">
								<div class="session-item-left">
									<span class="session-name text-sm">All Sessions</span>
								</div>
								<div class="session-item-right">
									<span class="session-size text-xs" id="totalSize">-</span>
								</div>
							</li>
						</ul>
					</div>
					<div class="selection-buttons-container">
						<button id="toggleSelectionModeBtn" class="toggle-selection-mode-btn" onclick="toggleSelectionMode()">
							<i class="fa-solid fa-list-check"></i>
						</button>
						<button id="deleteSelectedSessionsBtn" class="delete-selected-sessions-btn" onclick="confirmDeleteSelectedSessions()" style="display: none;">
							<i class="fa-solid fa-trash"></i> Delete
						</button>
					</div>
					<ul class="session-list list-none sessions-scrollable" id="sessionList">
					</ul>
					<ul class="session-list list-none sessions-scrollable" id="userList" style="display: none;">
					</ul>
					<ul class="session-list list-none sessions-scrollable" id="teamList" style="display: none;">
					</ul>
				</div>
			</div>

			<div class="sidebar-resizer" id="sidebarResizer" aria-hidden="true"></div>

			<div class="main-content">
				<div class="main-content-header">
					<div class="filters-group">
						<button class="mobile-sidebar-toggle" id="mobileSidebarToggle" onclick="toggleMobileSidebar()">
							<i class="fa-solid fa-bars"></i>
						</button>
						<div class="user-filter-dropdown-container relative">
							<button type="button" class="relative w-full cursor-default rounded-md bg-white dark:bg-[color:var(--bg-secondary)] py-1.5 pl-3 pr-10 text-left text-gray-900 dark:text-[color:var(--text-primary)] shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-[color:var(--border-color)] focus:outline-none focus:ring-2 focus:ring-blue-600 sm:text-sm sm:leading-6" id="userFilterDropdownBtn" onclick="toggleUserFilterDropdown(event)">
								<span class="flex items-center">
									<i class="fa-solid fa-users mr-2"></i>
									<span class="block truncate text-sm">Users</span>
								</span>
								<span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
									<i class="fa-solid fa-sort-down text-gray-400" id="userFilterChevron" aria-hidden="true"></i>
								</span>
							</button>
							<div class="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white dark:bg-[color:var(--bg-primary)] py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm hidden" id="userFilterDropdown" role="listbox">
								<div id="userFilterDropdownContent" role="listbox">
									<!-- User list will be populated by JavaScript -->
								</div>
							</div>
						</div>
						<div class="level-filters">
							<button class="level-filter-btn level-info active" data-level="session_start">
								<span class="text-sm font-medium">Session</span>
								<span class="level-count text-xs" id="count-session_start">0</span>
							</button>
							<button class="level-filter-btn level-debug active" data-level="tool_call">
								<span class="text-sm font-medium">Tool</span>
								<span class="level-count text-xs" id="count-tool_call">0</span>
							</button>
							<button class="level-filter-btn level-warning active" data-level="custom">
								<span class="text-sm font-medium">Custom</span>
								<span class="level-count text-xs" id="count-custom">0</span>
							</button>
							<button class="level-filter-btn level-error active" data-level="tool_error">
								<span class="text-sm font-medium">Error</span>
								<span class="level-count text-xs" id="count-tool_error">0</span>
							</button>
						</div>
					</div>
					<div class="search-controls">
						<input type="text" class="search-input" id="searchInput" placeholder="Search">
						<div class="icon-buttons-group">
							<button type="button" class="icon-btn" onclick="refreshLogs(event)"><i class="fa fa-refresh"></i></button>
							<button class="icon-btn notification-toggle" onclick="toggleNotificationMode()"><i class="fa-regular fa-bell"></i></button>
							<div class="user-menu-container" style="position: relative;">
								<button class="icon-btn user-btn" id="userBtn" onclick="showUserMenu(event)"><i class="fa-solid fa-wrench"></i></button>
								<div class="user-menu" id="userMenu"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="main-content-body">
					<div id="sessionActivityCard" class="session-activity-card hidden">
						<div class="session-activity-header">
							<div style="display: flex; align-items: center; gap: 8px;">
								<button class="date-nav-btn" id="prevDayBtn" onclick="navigateToPreviousDay()">
									<i class="fa-solid fa-chevron-left"></i>
								</button>
								<div>
									<p id="sessionActivityTitle" class="label">Timeline</p>
									<p id="sessionActivitySubtitle" class="subtitle">–</p>
								</div>
								<button class="date-nav-btn" id="nextDayBtn" onclick="navigateToNextDay()">
									<i class="fa-solid fa-chevron-right"></i>
								</button>
							</div>
							<div class="session-activity-legend-wrapper">
								<button
									type="button"
									class="session-activity-legend-toggle"
								>
									<img src="resources/colors.png" alt="" class="session-activity-legend-toggle-image">
								</button>
							<div id="sessionActivityLegend" class="session-activity-legend">
								<span class="legend-item">
									<span class="legend-dot" style="background: #0ea5e9;"></span>
									<span>Events per slot</span>
								</span>
								<span class="legend-item">
									<span class="legend-dot" style="background: rgba(16,185,129,0.7);"></span>
									<span>Office window</span>
								</span>
								</div>
							</div>
						</div>
						<div id="sessionActivityChart"></div>
					</div>
					<div class="horizontal-resizer" id="horizontalResizer" aria-hidden="true"></div>
					<div class="logs-table-container" id="logsTableContainer">
						<!-- <div id="loadingMessage" class="loading">Loading events...</div> -->
						<div id="errorMessage" class="error-message" style="display: none;"></div>
						<div id="emptyState" class="empty-state" style="display: none;">
							<div class="font-semibold mt-2.5">No events found</div>
						</div>
						<div id="logsTableScroll" style="flex: 1; overflow-y: auto; min-height: 0;">
							<table class="logs-table" id="logsTable" style="display: none;">
							<thead>
								<tr>
									<th style="width: 40px;"></th>
									<th style="width: 40px;"></th>
									<th class="time-column" style="width: 110px;">
										<span>Time</span>
										<button class="icon-btn sort-btn" id="sortBtn" title="Toggle sort order">
											<img src="/resources/sort-desc" alt="Sort descending" id="sortIcon" style="width: 16px; height: 16px;">
										</button>
									</th>
									<th class="user-column" style="width: 180px;">User</th>
									<th style="width: 130px;">Event</th>
									<th style="width: 200px;">Company</th>
									<th style="width: 150px;">Tool name</th>
									<th>Payload</th>
									<th style="width: 50px;"></th>
								</tr>
							</thead>
								<tbody id="logsBody">
								</tbody>
							</table>
						</div>
					</div>

				</div>
			</div>
		</div>
		<div class="footer-info">
			<span class="text-xs">Last updated: <span id="lastUpdatedInfo" class="font-semibold">never</span></span>
			<span class="text-xs">Load time: <span id="durationInfo" class="font-semibold">-</span></span>
			<span class="text-xs">Version: <span class="font-semibold">v1.0.0</span></span>
			<span class="text-xs" id="dbSizeInfo" style="display: none;">DB size: <span id="dbSize" class="font-semibold">-</span></span>
		</div>
	</div>

	<div class="mobile-sidebar-overlay" id="mobileSidebarOverlay" onclick="toggleMobileSidebar()"></div>

	<script src="/vendor/echarts/echarts.min.js"></script>
	<script src="/js/user-menu.js"></script>
	<script src="/js/event-log.js"></script>
</body>
</html>
