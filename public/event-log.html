<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/webp" sizes="32x32" href="/resources/favicon.webp">
	<link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/css/output.css" as="style">
	<link rel="stylesheet" href="/css/output.css">
	<link rel="preload" href="/vendor/fontawesome/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript>
		<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	</noscript>
	<link rel="preload" href="/vendor/fontawesome/css/v4-shims.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript>
		<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	</noscript>
	<script src="/js/polyfills.js" defer></script>
	<script src="/vendor/tailwindplus/elements.js" type="module"></script>
	<script>
		// Apply theme immediately before page render to prevent flash
		(function () {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || 'light';
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make container visible here - wait for chart to render
			// The container will be made visible when chart animation completes
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const container = document.querySelector('.container');
				if (container) {
					const computedStyle = window.getComputedStyle(container);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						container.style.visibility = 'visible';
						requestAnimationFrame(() => {
							container.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
</head>

<body class="event-log-page hydrating">
	<div class="container main-container">
		<div id="global-header-placeholder"></div>
		<script src="/js/header.js" defer></script>
		<script>
			// Initialize header for event log page after scripts are parsed
			window.addEventListener('DOMContentLoaded', () => {
				initGlobalHeader({
					activePage: '/logs',
					refreshButton: {
						onClick: 'refreshLogs(event)',
						id: 'refreshButton',
						showBadge: true,
						ariaLabel: 'Refresh now',
						title: 'Refresh now'
					},
					secondaryButton: {
						type: 'settings'
					}
				});
			});
		</script>
		<div class="container-content">
			<div class="content-wrapper">
				<div class="sidebar">
					<div class="sidebar-header">
						<div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
							<a href="/" class="back-link subtitle" data-soft-nav="true">← Back to Dashboard</a>
						</div>
						<div class="log-viewer-title font-semibold">Event logs</div>
					</div>
					<div class="sidebar-content">
						<div class="tabs-container">
							<button class="tab-btn active" id="sessionsTab" data-tab="sessions">
								<span class="text-xs font-semibold uppercase tracking-wider">Sessions</span>
							</button>
							<button class="tab-btn" id="usersTab" data-tab="users">
								<span class="text-xs font-semibold uppercase tracking-wider">Users</span>
							</button>
							<button class="tab-btn" id="teamsTab" data-tab="teams">
								<span class="text-xs font-semibold uppercase tracking-wider">Teams</span>
							</button>
							<button class="tab-btn" id="trashTab" data-tab="trash">
								<span class="text-xs font-semibold uppercase tracking-wider">Trash</span>
							</button>
							<div class="tab-indicator" id="tabIndicator"></div>
						</div>
						<div class="all-sessions-container" id="sessionsContainer">
							<ul class="session-list list-none">
								<li class="session-item active" data-session="all">
									<div class="session-item-left">
										<span class="session-name text-sm">All Sessions</span>
									</div>
									<div class="session-item-right">
										<span class="session-size text-xs" id="totalSize">-</span>
									</div>
								</li>
							</ul>
						</div>
						<div class="selection-buttons-container">
							<button id="toggleSelectionModeBtn" class="toggle-selection-mode-btn" onclick="toggleSelectionMode()">
								<i class="fa-solid fa-list-check"></i>
							</button>
							<button id="deleteSelectedSessionsBtn" class="delete-selected-sessions-btn" onclick="confirmDeleteSelectedSessions()" style="display: none;">
								<i class="fa-solid fa-trash"></i> Delete
							</button>
						</div>
						<ul class="session-list list-none sessions-scrollable" id="sessionList">
						</ul>
						<ul class="session-list list-none sessions-scrollable" id="userList" style="display: none;">
						</ul>
						<ul class="session-list list-none sessions-scrollable" id="teamList" style="display: none;">
						</ul>
						<div id="trashContainer" style="display: none;">
							<div class="trash-header" style="padding: 16px; border-bottom: 1px solid #e5e7eb; dark:border-gray-700;">
								<div class="font-semibold text-sm text-gray-900 dark:text-white mb-2">Deleted Events</div>
								<div class="text-xs text-gray-600 dark:text-gray-400 mb-4">
									Events moved to trash can be recovered or permanently deleted.
								</div>
								<div class="flex gap-2">
									<button id="emptyTrashBtn" class="btn btn-sm btn-outline btn-error" onclick="confirmEmptyTrash()">
										<i class="fa-solid fa-trash-alt"></i>
										Empty Trash
									</button>
									<button id="cleanupTrashBtn" class="btn btn-sm btn-outline" onclick="confirmCleanupTrash()">
										<i class="fa-solid fa-clock"></i>
										Cleanup Old
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="sidebar-resizer" id="sidebarResizer" aria-hidden="true"></div>

				<div class="main-content">
					<div class="main-content-header">
						<div class="filters-group">
							<button class="mobile-sidebar-toggle" id="mobileSidebarToggle" onclick="toggleMobileSidebar()">
								<i class="fa-solid fa-bars"></i>
							</button>
							<button type="button" class="icon-btn" id="sortBtn" aria-label="Toggle sort order" title="Toggle sort order">
								<img id="sortIcon" src="/resources/sort-desc" alt="Sort descending" width="18" height="18">
							</button>
							<div class="user-filter-dropdown-container relative">
								<button type="button" class="relative w-full cursor-default rounded-md bg-white dark:bg-(--bg-secondary) py-1.5 pl-3 pr-10 text-left text-gray-900 dark:text-(--text-primary) shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-(--border-color) focus:outline-none focus:ring-2 focus:ring-blue-600 sm:text-sm sm:leading-6" id="userFilterDropdownBtn" onclick="toggleUserFilterDropdown(event)">
									<span class="flex items-center">
										<i class="fa-solid fa-users mr-2"></i>
										<span class="block truncate text-sm">Users</span>
									</span>
									<span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
										<i class="fa-solid fa-sort-down text-gray-400" id="userFilterChevron" aria-hidden="true"></i>
									</span>
								</button>
								<div class="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white dark:bg-(--bg-primary) py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm hidden" id="userFilterDropdown" role="listbox">
									<div id="userFilterDropdownContent" role="listbox">
										<!-- User list will be populated by JavaScript -->
									</div>
								</div>
							</div>
							<div class="level-filters">
								<button class="level-filter-btn level-info active" data-level="session_start">
									<span class="text-sm font-medium">Session</span>
									<span class="level-count text-xs" id="count-session_start">0</span>
								</button>
								<button class="level-filter-btn level-debug active" data-level="tool_call">
									<span class="text-sm font-medium">Tool</span>
									<span class="level-count text-xs" id="count-tool_call">0</span>
								</button>
								<button class="level-filter-btn level-warning active" data-level="custom">
									<span class="text-sm font-medium">Custom</span>
									<span class="level-count text-xs" id="count-custom">0</span>
								</button>
								<button class="level-filter-btn level-error active" data-level="tool_error">
									<span class="text-sm font-medium">Error</span>
									<span class="level-count text-xs" id="count-tool_error">0</span>
								</button>
							</div>
						</div>
					</div>
					<div class="main-content-body">
						<div id="sessionActivityCard" class="session-activity-card overflow-hidden rounded-lg bg-white shadow-sm hidden" style="flex-direction: column;">
							<div class="session-activity-header-floating px-4 py-3 sm:px-6">
								<div class="session-activity-header">
									<div style="display: flex; align-items: center; gap: 4px;">
										<button class="date-nav-btn" id="prevDayBtn" onclick="navigateToPreviousDay()">
											<i class="fa-solid fa-caret-left"></i>
										</button>
										<div>
											<p id="sessionActivityTitle" class="label">Timeline</p>
											<p id="sessionActivitySubtitle" class="subtitle">–</p>
										</div>
										<button class="date-nav-btn" id="nextDayBtn" onclick="navigateToNextDay()">
											<i class="fa-solid fa-caret-right"></i>
										</button>
									</div>
									<div class="session-activity-legend-wrapper">
										<button
												type="button"
												class="session-activity-legend-toggle">
											<img src="resources/colors.webp" alt="" class="session-activity-legend-toggle-image">
										</button>
										<div id="sessionActivityLegend" class="session-activity-legend">
											<span class="legend-item">
												<span class="legend-dot" style="background: #0ea5e9;"></span>
												<span>Events per slot</span>
											</span>
											<span class="legend-item">
												<span class="legend-dot" style="background: rgba(16,185,129,0.7);"></span>
												<span>Office window</span>
											</span>
										</div>
									</div>
								</div>
							</div>
							<div class="session-activity-chart-body px-4 pt-0 pb-5 sm:px-6 sm:pt-0 sm:pb-6">
								<div id="sessionActivityChart" style="width: 100%; min-height: 0; height: 100%;"></div>
							</div>
						</div>
						<div class="horizontal-resizer" id="horizontalResizer" aria-hidden="true"></div>

							<!-- <div id="loadingMessage" class="loading">Loading events...</div> -->
							<div id="errorMessage" class="error-message" style="display: none;"></div>
							<div id="emptyState" class="empty-state" style="display: none;">
								<div class="font-semibold mt-2.5">No events found</div>
							</div>

					<div class="px-4 sm:px-6 lg:px-8 logs-table-container" style="background-color: #ffffff;">
						<div style="overflow-y: auto; max-height: calc(100vh - 300px);" id="logsTableScroll">
							<table class="logs-table min-w-full divide-y divide-gray-300 dark:divide-white/10" id="logsTable">
									<thead>
										<tr>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white sm:pl-0 uppercase">
												<span class="sr-only">Expand</span>
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-center text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase">
												Status
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase">
												Time
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase user-column">
												User
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase">
												Event Type
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase hidden md:table-cell">
												Company
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase hidden lg:table-cell">
												Tool Name
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase hidden xl:table-cell">
												Error Message
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white px-3 py-3.5 text-center text-sm font-semibold text-gray-900 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 dark:text-white uppercase">
												Payload
											</th>
											<th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white py-3.5 pl-3 pr-4 backdrop-blur-sm backdrop-filter dark:border-zinc-700 dark:bg-zinc-900 sm:pr-0">
												<span class="sr-only">Actions</span>
											</th>
										</tr>
									</thead>
								<tbody class="divide-y divide-gray-200 dark:divide-white/10" id="logsBody">
									<tr>
										<td colspan="10" class="py-8 text-center text-sm text-gray-500 dark:text-gray-400">
											Loading recent events...
										</td>
									</tr>
									</tbody>
								</table>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>

		<div class="mobile-sidebar-overlay" id="mobileSidebarOverlay" onclick="toggleMobileSidebar()"></div>

		<script>
			// Load ECharts asynchronously to avoid blocking initial render
			(function () {
				const script = document.createElement('script');
				script.src = '/vendor/echarts/echarts.min.js';
				script.async = true;
				script.onload = function () {
					// Dispatch event when ECharts is loaded
					window.dispatchEvent(new CustomEvent('echartsLoaded'));
				};
				document.head.appendChild(script);
			})();
		</script>
		<script src="/js/navigation.js" defer></script>
		<script src="/js/user-menu.js" defer></script>
		<script src="/js/csrf-helper.js" defer></script>
		<script src="/js/event-log.js?v=20251217" defer></script>
</body>

</html>
