<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon.png">
	<link href="/css/output.css" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script>
		// Apply theme immediately before page render to prevent flash
		(function() {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || 'dark';
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Make body visible after theme is applied
			function makeBodyVisible() {
				document.body.style.visibility = 'visible';
			}
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', makeBodyVisible);
			} else {
				// DOM already loaded, make visible immediately
				makeBodyVisible();
			}
		})();
	</script>
</head>
<body class="event-log-page">
	<div class="main-container">
		<div class="content-wrapper">
			<div class="sidebar">
				<div class="sidebar-header">
					<div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
						<a href="/" class="back-link subtitle">← Back to Home</a>
					</div>
					<div class="log-viewer-title text-xl font-semibold">Event log</div>
				</div>
				<div class="sidebar-content">
					<div class="sidebar-title text-xs font-semibold uppercase tracking-wider">Sessions</div>
					<div class="all-sessions-container">
						<ul class="server-list list-none">
							<li class="server-item active" data-session="all">
								<div class="server-item-left">
									<span class="server-name text-sm">All Sessions</span>
								</div>
								<div class="server-item-right">
									<span class="server-size text-xs" id="totalSize">-</span>
								</div>
							</li>
						</ul>
					</div>
					<ul class="server-list list-none sessions-scrollable" id="sessionList">
					</ul>
				</div>
			</div>

			<div class="sidebar-resizer" id="sidebarResizer" aria-hidden="true"></div>

			<div class="main-content">
				<div class="main-content-header">
					<div class="level-filters">
						<button class="level-filter-btn level-info" data-level="session_start">
							<input type="checkbox" checked id="filter-session_start" class="w-4 h-4 cursor-pointer">
							<span class="text-sm font-medium">Session</span>
							<span class="level-count text-xs" id="count-session_start">0</span>
						</button>
						<button class="level-filter-btn level-debug" data-level="tool_call">
							<input type="checkbox" checked id="filter-tool_call" class="w-4 h-4 cursor-pointer">
							<span class="text-sm font-medium">Tool</span>
							<span class="level-count text-xs" id="count-tool_call">0</span>
						</button>
						<button class="level-filter-btn level-warning" data-level="custom">
							<input type="checkbox" checked id="filter-custom" class="w-4 h-4 cursor-pointer">
							<span class="text-sm font-medium">Custom</span>
							<span class="level-count text-xs" id="count-custom">0</span>
						</button>
						<button class="level-filter-btn level-error" data-level="tool_error">
							<input type="checkbox" checked id="filter-tool_error" class="w-4 h-4 cursor-pointer">
							<span class="text-sm font-medium">Error</span>
							<span class="level-count text-xs" id="count-tool_error">0</span>
						</button>
					</div>
					<div class="search-controls">
						<input type="text" class="search-input" id="searchInput" placeholder="Search">
						<div class="icon-buttons-group">
							<button type="button" class="icon-btn" onclick="refreshLogs(event)"><i class="fa fa-refresh"></i></button>
							<button class="icon-btn delete-all-btn" onclick="confirmDeleteAll()"><i class="fa-regular fa-trash-can"></i></button>
							<button class="icon-btn notification-toggle" onclick="toggleNotificationMode()"><i class="fa-regular fa-bell"></i></button>
							<button class="icon-btn theme-toggle" onclick="toggleTheme()"><i class="fa-regular fa-moon"></i></button>
							<div class="user-menu-container" style="position: relative;">
								<button class="icon-btn user-btn" id="userBtn" onclick="showUserMenu(event)"><i class="fa-regular fa-user"></i></button>
								<div class="user-menu" id="userMenu" style="display: none;">
									<div class="user-menu-item" id="userMenuUsername"><i class="fa-regular fa-user user-menu-icon"></i>Loading...</div>
									<button class="user-menu-item" onclick="handleLogout()">Logout</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="main-content-body">
					<div id="sessionActivityCard" class="session-activity-card hidden">
						<div class="session-activity-header">
							<div style="display: flex; align-items: center; gap: 8px;">
								<button class="date-nav-btn" id="prevDayBtn" onclick="navigateToPreviousDay()">
									<i class="fa-solid fa-chevron-left"></i>
								</button>
								<div>
									<p id="sessionActivityTitle" class="label">Activity overview</p>
									<p id="sessionActivitySubtitle" class="subtitle">–</p>
								</div>
								<button class="date-nav-btn" id="nextDayBtn" onclick="navigateToNextDay()">
									<i class="fa-solid fa-chevron-right"></i>
								</button>
							</div>
							<div class="session-activity-legend-wrapper">
								<button
									type="button"
									class="session-activity-legend-toggle"
								>
									<img src="resources/colors.png" alt="" class="session-activity-legend-toggle-image">
									<span>Legend</span>
								</button>
							<div id="sessionActivityLegend" class="session-activity-legend">
								<span class="legend-item">
									<span class="legend-dot" style="background: #0ea5e9;"></span>
									<span>Events per slot</span>
								</span>
								<span class="legend-item">
									<span class="legend-dot" style="background: rgba(16,185,129,0.7);"></span>
									<span>Office window</span>
								</span>
								</div>
							</div>
						</div>
						<div id="sessionActivityChart"></div>
					</div>
					<div class="horizontal-resizer" id="horizontalResizer" aria-hidden="true"></div>
					<div class="table-controls" id="tableControls" style="display: none;">
						<div class="table-controls-right">
							<select class="control-select" id="sortSelect">
								<option value="DESC">Newest first</option>
								<option value="ASC">Oldest first</option>
							</select>
							<select class="control-select" id="limitSelect">
								<option value="25">25 items per page</option>
								<option value="50" selected>50 items per page</option>
								<option value="100">100 items per page</option>
							</select>
						</div>
					</div>
					<div class="logs-table-container" id="logsTableContainer">
						<div id="loadingMessage" class="loading">Loading events...</div>
						<div id="errorMessage" class="error-message" style="display: none;"></div>
						<div id="emptyState" class="empty-state" style="display: none;">
							<div class="font-semibold mt-2.5">No events found</div>
						</div>
						<div id="logsTableScroll" style="flex: 1; overflow-y: auto; min-height: 0;">
							<table class="logs-table" id="logsTable" style="display: none;">
								<thead>
									<tr>
										<th style="width: 40px;"></th>
										<th style="width: 40px;"></th>
										<th class="time-column" style="width: 110px;">Time</th>
										<th style="width: 130px;">Event</th>
										<th style="width: 200px;">Company</th>
										<th>Payload</th>
										<th style="width: 50px;"></th>
									</tr>
								</thead>
								<tbody id="logsBody">
								</tbody>
							</table>
						</div>
					</div>
					<div class="pagination" id="pagination" style="display: none;">
						<button class="pagination-btn" onclick="previousPage()" id="prevBtn">← Previous</button>
						<span class="pagination-info" id="pageInfo"></span>
						<button class="pagination-btn" onclick="nextPage()" id="nextBtn">Next →</button>
					</div>
					<div class="footer-info">
						<span class="text-xs">Load time: <span id="durationInfo" class="font-semibold">-</span></span>
						<span class="text-xs">Version: <span class="font-semibold">v1.0.0</span></span>
						<span class="text-xs" id="dbSizeInfo" style="display: none;">DB size: <span id="dbSize" class="font-semibold">-</span></span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="/vendor/echarts/echarts.min.js"></script>
	<script src="/js/event-log.js"></script>
</body>
</html>
