<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/webp" sizes="32x32" href="/resources/favicon.webp">

	<!-- Preconnect to external domains for faster loading -->
	<link rel="preconnect" href="https://cdn.jsdelivr.net">

	<!-- Preload local fonts and main stylesheet -->
	<!-- <link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin> -->
	<!-- <link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin> -->
	<link rel="preload" href="/css/output.css" as="style">
	<link rel="stylesheet" href="/css/output.css">

	<!-- Load FontAwesome -->
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script src="/js/polyfills.js" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module" defer></script>
	<script>
		// Apply theme immediately before page render to prevent flash
		(function () {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || 'light';
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make container visible here - wait for chart to render
			// The container will be made visible when chart animation completes
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const container = document.querySelector('.container');
				if (container) {
					const computedStyle = window.getComputedStyle(container);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						container.style.visibility = 'visible';
						requestAnimationFrame(() => {
							container.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
	<style>
		.server-stats-gradient {
			background: linear-gradient(180deg, #ececec 0%, #e2e2e2 100%);
		}

		html.dark .server-stats-gradient {
			background: linear-gradient(135deg, #1e293b 0%, #2d3748 100%);
		}
	</style>
</head>

<body class="index-page hydrating cursor-default">
	<div class="container main-container">
		<div id="global-header-placeholder"></div>
		<script src="/js/command-palette.js" defer></script>
		<script src="/js/header.js" defer></script>
		<script>
			// Initialize header for dashboard page after scripts are parsed
			window.addEventListener('DOMContentLoaded', () => {
				initGlobalHeader();
			});
		</script>
		<div class="container-content">
			<div class="dashboard-row-top">
				<div style="display: grid; grid-template-columns: 2.1fr 1fr; gap: 27px; align-items: stretch; height: 100%;">
					<section class="dashboard-chart-card overflow-hidden rounded-lg bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs h-full flex flex-col">
						<div class="chart-floating-header px-4 py-5 sm:px-6">
							<div class="chart-header" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 12px;">
								<div>
									<div id="chartLegendOverlay" class="chart-legend-overlay" aria-hidden="true" data-state="empty"></div>
									<h1 class="log-viewer-title" style="margin: 0 0 4px 0;">Dashboard</h1>
								</div>
								<label class="sr-only" for="timeRangeSelect">Select date range</label>
								<div class="relative block w-full sm:w-auto sm:ml-auto">
									<select id="timeRangeSelect" name="timeRangeSelect" data-floating-interactive
											class="block appearance-none rounded-md dark:bg-white/5 py-2 pl-2 pr-12 text-xs text-gray-900 dark:text-white dark:outline-white/10">
										<option value="7">Last 7 days</option>
										<option value="14">Last 14 days</option>
										<option value="30" selected>Last month</option>
										<option value="180">Last 6 months</option>
									</select>
									<div class="absolute inset-y-0 right-0 flex items-center pr-3" style="transform: inherit;">
										<svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-5 text-gray-400">
											<path d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
										</svg>
									</div>
								</div>
							</div>
						</div>
						<div class="chart-body card-body px-4 pt-0 pb-5 sm:px-6 sm:pt-0 sm:pb-6">
							<div id="eventsChart"></div>
						</div>
					</section>
					<section class="rounded-lg shadow-s bg-gray-400/10 dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top teams
								<span class="ml-1 text-sm font-normal text-gray-500">(last 30 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 30 days.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:pt-0 text-left">
							<ul id="topTeamsList" class="top-users-list">
								<li class="top-users-empty">Loading top teams…</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-row-bottom">
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 27px; flex: 1;">
					<section class="rounded-lg shadow-xs bg-gray-400/10 dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top users
								<span class="ml-1 text-sm font-normal text-gray-500">(last 14 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 14 days.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:pt-0 sm:pb-6 text-left">
							<ul id="topUsersList" class="top-users-list">
								<li class="top-users-empty">Loading top users…</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg server-stats-gradient dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs" id="serverStatsCard" style="text-align: left;">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Server stats</h3>
							<p class="mt-1 text-sm text-gray-500">Live telemetry server metrics.</p>
						</div>
						<div class="card-body sm:px-6">
							<dl class="grid grid-cols-1 divide-gray-200 divide-y overflow-hidden">
								<div class="py-2">
									<dt class="stats-title">Server Version</dt>
									<dd class="mt-1 flex items-baseline justify-between md:block lg:flex">
										<div class="flex items-baseline font-semibold text-indigo-600" id="serverStatsVersion">
											Loading...
										</div>
									</dd>
								</div>
								<div class="py-2">
									<dt class="stats-title">Uptime</dt>
									<dd class="mt-1 flex items-baseline justify-between md:block lg:flex">
										<div class="flex items-baseline font-semibold text-indigo-600" id="serverStatsUptime">
											Loading...
										</div>
									</dd>
								</div>
								<div class="py-2">
									<dt class="stats-title">Database Status</dt>
									<dd class="mt-1 flex items-baseline justify-between md:block lg:flex">
										<div class="flex items-baseline font-semibold text-indigo-600" id="serverStatsDbStatus">
											Loading...
										</div>
										<div class="inline-flex items-baseline rounded-full px-2.5 py-0.5 text-sm font-medium md:mt-2 lg:mt-0" id="serverStatsDbStatusBadge">
											<span class="sr-only">Status: </span>
											-
										</div>
									</dd>
								</div>
							</dl>
						</div>
						<div class="card-footer px-4 py-3 sm:px-6 border-t border-gray-200 dark:border-gray-700/50">
							<div class="flex items-center justify-between text-xs text-gray-500">
								<span>Last updated: <span id="serverStatsLastUpdated">never</span></span>
								<span>Load time: <span id="serverStatsLoadTime">-</span></span>
							</div>
						</div>

					</section>
					<section class="overflow-hidden rounded-lg dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs" style="background: #f8f9f9;">
						<div class="px-4 pt-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Tool usage</h3>
							<p class="mt-1 text-sm text-gray-500">Keep track of your tool usage.</p>
						</div>
						<div class="card-body px-2" style="height: 230px; filter: saturate(0.85);">
							<div id="toolUsageChart" style="width: 100%; height: 100%;"></div>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-footer">
				<a href="/health">Health check</a> ·
				<a href="/api/events">API</a> ·
				<a href="/schema">Schema</a>
			</div>
		</div>
	</div>

	<!-- Load ECharts with defer to ensure it loads before chart initialization scripts -->
	<script src="/vendor/echarts/echarts.min.js" defer></script>
	<script src="/js/global-cache.js" defer></script>
	<script src="/js/navigation.js" defer></script>
	<script src="/js/csrf-helper.js" defer></script>
	<script src="/js/notifications.js" type="module" defer></script>
	<script type="module" src="/js/index.js" defer></script>
	<script type="module" src="/js/tool-usage-chart.js" defer></script>
	<script type="module" src="/js/user-menu.js" defer></script>
	<script type="module" src="/js/settings-modal.js" defer></script>
	<script type="module" src="/js/app.js" defer></script>
</body>

</html>