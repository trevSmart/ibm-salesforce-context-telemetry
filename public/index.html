<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon.png">
	<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
	<link href="/css/output.css" rel="stylesheet">
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script src="/js/polyfills.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
	<script>
		// Apply theme immediately before page render to prevent flash
		(function () {
			const savedTheme = localStorage.getItem('theme');
			const systemTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			const theme = savedTheme || systemTheme;
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make container visible here - wait for chart to render
			// The container will be made visible when chart animation completes
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const container = document.querySelector('.container');
				if (container) {
					const computedStyle = window.getComputedStyle(container);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						container.style.visibility = 'visible';
						requestAnimationFrame(() => {
							container.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
</head>

<body class="index-page">
	<div class="container">
		<nav class="top-nav">
			<a href="/" class="top-nav-logo">
				<div class="top-nav-logo-icon">
					<img src="/resources/custom30.png" alt="IBM SF CTXT TELEMETRY" class="top-nav-logo-img">
				</div>
				<span>TELEMETRY</span>
			</a>
			<div class="top-nav-links">
				<a href="/" class="top-nav-link active">Dashboard</a>
				<a href="/logs" class="top-nav-link">Logs</a>
				<a href="/teams" class="top-nav-link">Teams</a>
			</div>
			<div class="top-nav-search">
				<input type="text" class="top-nav-search-input" placeholder="Search" id="searchInput">
			</div>
			<div class="top-nav-actions">
				<button type="button" class="icon-btn" onclick="refreshDashboard(event)">
					<svg class="refresh-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="18" height="18" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
					  </svg>
				</button>
				<button class="icon-btn notification-toggle" onclick="toggleNotificationMode()" aria-label="Toggle notifications" title="Enable notifications">
					<svg class="notification-bell-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="18" height="18" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
					</svg>
				</button>
				<el-dropdown class="user-menu-container inline-block">
					<button class="icon-btn user-btn inline-flex items-center gap-1.5" id="userBtn" onclick="showUserMenu(event)" aria-label="User menu">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18" aria-hidden="true">
							<path fill-rule="evenodd" d="M12 2.25a5.25 5.25 0 0 0-3.717 8.966 8.252 8.252 0 0 0-4.367 7.284.75.75 0 0 0 1.5 0 6.75 6.75 0 1 1 13.5 0 .75.75 0 0 0 1.5 0 8.252 8.252 0 0 0-4.366-7.284A5.25 5.25 0 0 0 12 2.25Zm0 1.5a3.75 3.75 0 1 1 0 7.5 3.75 3.75 0 0 1 0-7.5Z" clip-rule="evenodd"/>
						</svg>
						<svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-4 text-(--text-secondary)">
							<path d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
						</svg>
					</button>
					<el-menu id="userMenu" anchor="bottom end" popover class="origin-top-right divide-y divide-gray-100 rounded-md bg-white text-gray-900 shadow-lg ring-1 ring-black/5 transition transition-discrete dark:divide-white/10 dark:bg-zinc-900 dark:text-gray-50 [--anchor-gap:--spacing(2)] data-closed:scale-95 data-closed:transform data-closed:opacity-0 data-enter:duration-100 data-enter:ease-out data-leave:duration-75 data-leave:ease-in"></el-menu>
				</el-dropdown>
			</div>
		</nav>
		<div class="container-content">
			<div class="dashboard-row-top">
				<div style="display: grid; grid-template-columns: 2.4fr 1fr; gap: 24px; align-items: stretch; height: 100%;">
			<section class="dashboard-chart-card overflow-hidden rounded-lg bg-white shadow-sm h-full flex flex-col">
				<div class="chart-floating-header px-4 py-5 sm:px-6">
					<div class="chart-header" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 12px;">
						<div>
							<h1 class="log-viewer-title" style="margin: 0 0 4px 0;">Dashboard</h1>
						</div>
					<label class="sr-only" for="timeRangeSelect">Select date range</label>
					<select id="timeRangeSelect" name="timeRangeSelect" data-floating-interactive
						class="block w-full sm:w-auto sm:ml-auto rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-sm font-medium text-gray-900 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">
						<option value="7">Last 7 days</option>
						<option value="14">Last 14 days</option>
						<option value="30">Last month</option>
						<option value="180">Last 6 months</option>
					</select>
							</div>
				</div>
				<div class="chart-body px-4 py-5 sm:p-6">
					<div id="eventsChart"></div>
					<div id="chartLegendOverlay" class="chart-legend-overlay" aria-hidden="true" data-state="empty"></div>
				</div>
			</section>
					<section>
						<div class="px-4 py-5 sm:p-6" style="text-align: left;">
							<h2 style="margin: 0 0 8px 0;">Top teams <span style="font-size: calc(1em - 2.6px);">(last 30 days)</span></h2>
							<p style="margin: 0 0 12px 0;">Sorted by event volume across the last 30 days.</p>
							<ul id="topTeamsList" class="top-users-list">
								<li class="top-users-empty">Loading top teams…</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-row-bottom">
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; flex: 1;">
					<section>
						<div class="px-4 py-5 sm:p-6" style="text-align: left;">
							<h2 style="margin: 0 0 8px 0;">Top users <span style="font-size: calc(1em - 2.6px);">(last 3 days)</span></h2>
							<p style="margin: 0 0 12px 0;">Sorted by event volume across the last 3 days.</p>
							<ul id="topUsersList" class="top-users-list">
								<li class="top-users-empty">Loading top users…</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg bg-white shadow-sm" id="serverStatsCard" style="text-align: left;">
						<div class="px-4 py-5 sm:p-6" style="display: flex; flex-direction: column; gap: 10px;">
							<h2 style="margin: 0;">Server Stats</h2>
							<ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px;">
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Last updated</span>
									<span id="serverStatsLastUpdated" class="font-semibold">Loading...</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Load time</span>
									<span id="serverStatsLoadTime" class="font-semibold">-</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Version</span>
									<span id="serverStatsVersion" class="font-semibold">-</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">DB size</span>
									<span id="serverStatsDbSize" class="font-semibold">-</span>
								</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg bg-white shadow-sm">
						<div class="px-4 py-5 sm:p-6" style="text-align: left;">
							<h2 style="margin: 0 0 8px 0;">Proposal Tracker</h2>
							<p style="margin: 0 0 12px 0;">Keep track of your pitches.</p>
							<ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px;">
								<li><input type="checkbox" aria-label="Design project submitted" checked> Design Project · Last month</li>
								<li><input type="checkbox" aria-label="Video project submitted"> Video Project · Last week</li>
								<li>Copyright Project · 72% complete</li>
								<li>Web Design Project · 33% complete</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-footer">
				<span class="dashboard-status-ok">Server is running</span> ·
				<a href="/health">Health Check</a> ·
				<a href="/api/events">API</a> ·
				<a href="/schema">Schema</a>
			</div>
		</div>
	</div>

	<script>
		// Load ECharts asynchronously to avoid blocking initial render
		(function () {
			const script = document.createElement('script');
			script.src = '/vendor/echarts/echarts.min.js';
			script.async = true;
			script.onload = function () {
				// Dispatch event when ECharts is loaded
				window.dispatchEvent(new CustomEvent('echartsLoaded'));
			};
			document.head.appendChild(script);
		})();
	</script>
	<script src="/js/navigation.js"></script>
	<script src="/js/user-menu.js"></script>
	<script src="/js/csrf-helper.js"></script>
	<script type="module" src="/js/index.js"></script>
</body>

</html>
