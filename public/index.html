<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon.png">
	<link href="/css/output.css" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script>
		// Apply theme immediately before page render to prevent flash
		(function() {
			const savedTheme = localStorage.getItem('theme');
			const systemTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			const theme = savedTheme || systemTheme;
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Make body visible after theme is applied
			function makeBodyVisible() {
				document.body.style.visibility = 'visible';
			}
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', makeBodyVisible);
			} else {
				// DOM already loaded, make visible immediately
				makeBodyVisible();
			}
		})();
	</script>
</head>
<body class="index-page" style="visibility: hidden;">
	<div class="container">
		<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
			<h1 style="margin: 0;">IBM Salesforce Context Telemetry Server</h1>
			<div class="user-menu-container" style="position: relative;">
				<button class="icon-btn user-btn" id="userBtn" onclick="showUserMenu(event)"><i class="fa-solid fa-wrench"></i></button>
				<div class="user-menu" id="userMenu">
					<div class="user-menu-item" id="userMenuUsername"><i class="fa-solid fa-wrench user-menu-icon"></i>Loading...</div>
					<button class="user-menu-item" onclick="handleLogout()">Logout</button>
				</div>
			</div>
		</div>

		<div class="chart-container">
			<div class="chart-header">
				<div class="chart-title">Events per day</div>
				<select id="timeRangeSelect" class="time-range-select">
					<option value="7" selected>Last 7 days</option>
					<option value="15">Last 15 days</option>
					<option value="30">Last 30 days</option>
					<option value="90">Last 3 months</option>
				</select>
			</div>
			<canvas id="eventsChart"></canvas>
		</div>

		<a href="/event-log" class="event-log-link" id="eventLogLink" style="display: none;">Event log</a>
		<div class="status-info">
			<p>Server is running ✅</p>
			<p>
				<a href="/health">Health Check</a> •
				<a href="/api/events">API</a> •
				<a href="/schema">Schema</a>
			</p>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<script src="/js/index.js"></script>
</body>
</html>

