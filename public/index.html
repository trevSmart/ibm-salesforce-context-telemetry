<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/webp" sizes="32x32" href="/resources/favicon.webp">

	<!-- Preconnect to external domains for faster loading -->
	<link rel="preconnect" href="https://cdn.jsdelivr.net">

	<!-- Preload local fonts and main stylesheet -->
	<!-- <link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin> -->
	<!-- <link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin> -->
	<link rel="preload" href="/css/output.css" as="style">
	<link rel="stylesheet" href="/css/output.css">

	<!-- Load FontAwesome -->
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script src="/js/polyfills.js" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module" defer></script>
	<script>
		// Apply theme immediately before page render to prevent flash
		(function () {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || 'light';
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make container visible here - wait for chart to render
			// The container will be made visible when chart animation completes
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const container = document.querySelector('.container');
				if (container) {
					const computedStyle = window.getComputedStyle(container);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						container.style.visibility = 'visible';
						requestAnimationFrame(() => {
							container.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
	<style>
		.server-stats-gradient {
			background: linear-gradient(180deg, #ececec 0%, #e2e2e2 100%);
		}

		html.dark .server-stats-gradient {
			background: linear-gradient(135deg, #1e293b 0%, #2d3748 100%);
		}
	</style>
</head>

<body class="index-page hydrating cursor-default">
	<div class="container main-container">
		<div id="global-header-placeholder"></div>
		<script src="/js/command-palette.js" defer></script>
		<script src="/js/header.js" defer></script>
		<script>
			// Initialize header for dashboard page after scripts are parsed
			window.addEventListener('DOMContentLoaded', () => {
				initGlobalHeader();
			});
		</script>
		<div class="container-content">
			<div class="dashboard-row-top">
				<div style="display: grid; grid-template-columns: 2.1fr 1fr; gap: 27px; align-items: stretch; height: 100%;">
					<section class="dashboard-chart-card overflow-hidden rounded-lg bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs h-full flex flex-col">
						<div class="chart-floating-header px-4 py-5 sm:px-6">
							<div class="chart-header" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 12px;">
								<div>
									<div id="chartLegendOverlay" class="chart-legend-overlay" aria-hidden="true" data-state="empty"></div>
									<h1 class="log-viewer-title" style="margin: 0 0 4px 0;">Dashboard</h1>
								</div>
								<label class="sr-only" for="timeRangeSelect">Select date range</label>
								<div class="relative block w-full sm:w-auto sm:ml-auto">
									<select id="timeRangeSelect" name="timeRangeSelect" data-floating-interactive
											class="block appearance-none rounded-md dark:bg-white/5 py-2 pl-2 pr-12 text-xs text-gray-900 dark:text-white dark:outline-white/10">
										<option value="7">Last 7 days</option>
										<option value="14">Last 14 days</option>
										<option value="30" selected>Last month</option>
										<option value="180">Last 6 months</option>
									</select>
									<div class="absolute inset-y-0 right-0 flex items-center pr-3" style="transform: inherit;">
										<svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-5 text-gray-400">
											<path d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
										</svg>
									</div>
								</div>
							</div>
						</div>
						<div class="chart-body card-body px-4 pt-0 pb-5 sm:px-6 sm:pt-0 sm:pb-6">
							<div id="eventsChart"></div>
						</div>
					</section>
					<section class="rounded-lg shadow-s bg-gray-400/10 dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top teams
								<span class="ml-1 text-sm font-normal text-gray-500">(last 30 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 30 days.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:pt-0 text-left">
							<ul id="topTeamsList" class="top-users-list">
								<li class="top-users-empty">Loading top teams…</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-row-bottom">
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 27px; flex: 1;">
					<section class="rounded-lg shadow-xs bg-gray-400/10 dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top users
								<span class="ml-1 text-sm font-normal text-gray-500">(last 14 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 14 days.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:pt-0 sm:pb-6 text-left">
							<ul id="topUsersList" class="top-users-list">
								<li class="top-users-empty">Loading top users…</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg bg-gray-50 shadow-xs outline-1 outline-gray-900/5 dark:outline dark:-outline-offset-1 dark:outline-white/10" id="serverStatsCard" style="text-align: left;">
						<div class="px-4 pt-5 pb-0 sm:px-6">
							<div class="flex items-center justify-between">
								<h3 class="text-base font-semibold text-gray-900 dark:text-white">Server stats</h3>
								<div class="flex items-center gap-2">
									<span class="text-xs font-medium text-green-700 dark:text-green-400">Connected</span>
									<div class="h-2 w-2 rounded-full bg-green-500 dark:bg-green-400"></div>
								</div>
							</div>
							<p class="mt-1 text-sm text-gray-500 dark:text-gray-400"><a href="/health">View health check <span aria-hidden="true">&rarr;</span></a></p>
						</div>
						<dl class="flex flex-wrap">
							<div class="flex w-full flex-none gap-x-4 px-6 pt-6">
								<dt class="flex-none">
									<span class="sr-only">Uptime</span>
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="h-6 w-5 text-gray-400 dark:text-gray-500">
										<path d="M4.632 3.533A2 2 0 0 1 6.577 2h6.846a2 2 0 0 1 1.945 1.533l1.976 8.234A3.489 3.489 0 0 0 16 11.5H4c.476 0 .93.095 1.344.267l-1.976-8.234Z" />
										<path d="M4 13a2 2 0 1 0 0 4h12a2 2 0 1 0 0-4H4Z" />
									</svg>
								</dt>
								<dd class="text-sm/6 text-gray-900 dark:text-white">
									<span>Uptime:</span> <span class="font-semibold" id="serverStatsUptime">Loading...</span>
								</dd>
							</div>
							<div class="mt-3 flex w-full flex-none gap-x-4 px-6">
								<dt class="flex-none">
									<span class="sr-only">Server Version</span>
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="h-6 w-5 text-gray-400 dark:text-gray-500">
										<path d="M12 2.25H8A2.75 2.75 0 0 0 5.25 5v.25H4A2.75 2.75 0 0 0 1.25 8v8A2.75 2.75 0 0 0 4 18.75h12A2.75 2.75 0 0 0 18.75 16V8A2.75 2.75 0 0 0 16 5.25h-1.25V5A2.75 2.75 0 0 0 12 2.25ZM7.5 5v.25h5V5A1.25 1.25 0 0 1 13.75 3.75h-7.5A1.25 1.25 0 0 1 5.25 5v.25h2.25ZM4 7.5A1.25 1.25 0 0 1 5.25 6.25h9.5A1.25 1.25 0 0 1 16 7.5v8.75a1.25 1.25 0 0 1-1.25 1.25H5.25A1.25 1.25 0 0 1 4 16.25V7.5Z" clip-rule="evenodd" fill-rule="evenodd" />
										<path d="M10 8.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 10 8.5Zm0 4.25a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 .75-.75Z" />
									</svg>
								</dt>
								<dd class="text-sm/6 text-gray-500 dark:text-gray-400">
									<span>Server Version:</span> <span class="font-semibold" id="serverStatsVersion">Loading...</span>
								</dd>
							</div>
							<div class="mt-3 flex w-full flex-none gap-x-4 px-6">
								<dt class="flex-none">
									<span class="sr-only">Database Status</span>
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="h-6 w-5 text-gray-400 dark:text-gray-500">
										<path d="M12 2.25H8A2.75 2.75 0 0 0 5.25 5v.25H4A2.75 2.75 0 0 0 1.25 8v8A2.75 2.75 0 0 0 4 18.75h12A2.75 2.75 0 0 0 18.75 16V8A2.75 2.75 0 0 0 16 5.25h-1.25V5A2.75 2.75 0 0 0 12 2.25ZM7.5 5v.25h5V5A1.25 1.25 0 0 1 13.75 3.75h-7.5A1.25 1.25 0 0 1 5.25 5v.25h2.25ZM4 7.5A1.25 1.25 0 0 1 5.25 6.25h9.5A1.25 1.25 0 0 1 16 7.5v8.75a1.25 1.25 0 0 1-1.25 1.25H5.25A1.25 1.25 0 0 1 4 16.25V7.5Z" clip-rule="evenodd" fill-rule="evenodd" />
									</svg>
								</dt>
								<dd class="text-sm/6 text-gray-500 dark:text-gray-400">
									<span>Database Size:</span> <span class="font-semibold" id="serverStatsDbSize">Loading...</span>
								</dd>
							</div>
							<div class="mt-3 flex w-full flex-none gap-x-4 px-6">
								<dt class="flex-none">
									<span class="sr-only">Last Updated</span>
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="h-6 w-5 text-gray-400 dark:text-gray-500">
										<path d="M5.25 12a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H6a.75.75 0 0 1-.75-.75V12ZM6 13.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V14a.75.75 0 0 0-.75-.75H6ZM7.25 12a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H8a.75.75 0 0 1-.75-.75V12ZM8 13.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V14a.75.75 0 0 0-.75-.75H8ZM9.25 10a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H10a.75.75 0 0 1-.75-.75V10ZM10 11.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V12a.75.75 0 0 0-.75-.75H10ZM9.25 14a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H10a.75.75 0 0 1-.75-.75V14ZM12 9.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V10a.75.75 0 0 0-.75-.75H12ZM11.25 12a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H12a.75.75 0 0 1-.75-.75V12ZM12 13.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V14a.75.75 0 0 0-.75-.75H12ZM13.25 10a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 .75.75v.01a.75.75 0 0 1-.75.75H14a.75.75 0 0 1-.75-.75V10ZM14 11.25a.75.75 0 0 0-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 0 0 .75-.75V12a.75.75 0 0 0-.75-.75H14Z" />
										<path d="M5.75 2a.75.75 0 0 1 .75.75V4h7V2.75a.75.75 0 0 1 1.5 0V4h.25A2.75 2.75 0 0 1 18 6.75v8.5A2.75 2.75 0 0 1 15.25 18H4.75A2.75 2.75 0 0 1 2 15.25v-8.5A2.75 2.75 0 0 1 4.75 4H5V2.75A.75.75 0 0 1 5.75 2Zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75Z" clip-rule="evenodd" fill-rule="evenodd" />
									</svg>
								</dt>
								<dd class="text-sm/6 text-gray-500 dark:text-gray-400">
									<span>Last Updated:</span> <time class="font-semibold" id="serverStatsLastUpdated">never</time>
								</dd>
							</div>
							<div class="mt-3 flex w-full flex-none gap-x-4 px-6">
								<dt class="flex-none">
									<span class="sr-only">Load Time</span>
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="h-6 w-5 text-gray-400 dark:text-gray-500">
										<path d="M2.5 4A1.5 1.5 0 0 0 1 5.5V6h18v-.5A1.5 1.5 0 0 0 17.5 4h-15ZM19 8.5H1v6A1.5 1.5 0 0 0 2.5 16h15a1.5 1.5 0 0 0 1.5-1.5v-6ZM3 13.25a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75Zm4.75-.75a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5h-3.5Z" clip-rule="evenodd" fill-rule="evenodd" />
									</svg>
								</dt>
								<dd class="text-sm/6 text-gray-500 dark:text-gray-400">
									<span>Load Time:</span> <span class="font-semibold" id="serverStatsLoadTime">-</span>
								</dd>
							</div>
						</dl>

					</section>
					<section class="overflow-hidden rounded-lg dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs" style="background: #f8f9f9;">
						<div class="px-4 pt-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Tool usage</h3>
							<p class="mt-1 text-sm text-gray-500">Tool calls over the last 30 days.</p>
						</div>
						<div class="card-body px-2" style="height: 230px; filter: saturate(0.85);">
							<div id="toolUsageChart" style="width: 100%; height: 100%;"></div>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-footer">
				<a href="/health" target="_blank" rel="noopener noreferrer">Health check</a> ·
				<a href="/schema" target="_blank" rel="noopener noreferrer">Schema</a> ·
				<a href="https://dashboard.render.com/" target="_blank" rel="noopener noreferrer">Render</a>
			</div>
		</div>
	</div>

	<!-- Load ECharts with defer to ensure it loads before chart initialization scripts -->
	<script src="/vendor/echarts/echarts.min.js" defer></script>
	<script src="/js/global-cache.js" defer></script>
	<script src="/js/navigation.js" defer></script>
	<script src="/js/csrf-helper.js" defer></script>
	<script src="/js/notifications.js" type="module" defer></script>
	<script type="module" src="/js/index.js" defer></script>
	<script type="module" src="/js/tool-usage-chart.js" defer></script>
	<script type="module" src="/js/user-menu.js" defer></script>
	<script type="module" src="/js/settings-modal.js" defer></script>
	<script type="module" src="/js/app.js" defer></script>
</body>

</html>