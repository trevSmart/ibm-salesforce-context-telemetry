<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon.png">
	<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
	<link href="/css/output.css" rel="stylesheet">
	<link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css">
	<script src="/js/polyfills.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
	<script>
		// Apply theme immediately before page render to prevent flash
		(function () {
			const savedTheme = localStorage.getItem('theme');
			const systemTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			const theme = savedTheme || systemTheme;
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make container visible here - wait for chart to render
			// The container will be made visible when chart animation completes
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const container = document.querySelector('.container');
				if (container) {
					const computedStyle = window.getComputedStyle(container);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						container.style.visibility = 'visible';
						requestAnimationFrame(() => {
							container.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
</head>

<body class="index-page">
	<div class="container main-container">
		<div id="global-header-placeholder"></div>
		<script src="/js/header.js"></script>
		<script>
			// Initialize header for dashboard page
			initGlobalHeader({
				activePage: '/',
				refreshButton: {
					onClick: 'refreshDashboard(event)',
					ariaLabel: 'Refresh dashboard',
					title: 'Refresh dashboard'
				},
				secondaryButton: {
					type: 'notification'
				}
			});
		</script>
		<div class="container-content">
			<div class="dashboard-row-top">
				<div style="display: grid; grid-template-columns: 2.4fr 1fr; gap: 24px; align-items: stretch; height: 100%;">
			<section class="dashboard-chart-card overflow-hidden rounded-lg bg-white shadow-sm h-full flex flex-col">
				<div class="chart-floating-header px-4 py-5 sm:px-6">
					<div class="chart-header" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 12px;">
						<div>
							<h1 class="log-viewer-title" style="margin: 0 0 4px 0;">Dashboard</h1>
						</div>
					<label class="sr-only" for="timeRangeSelect">Select date range</label>
					<select id="timeRangeSelect" name="timeRangeSelect" data-floating-interactive
						class="block w-full sm:w-auto sm:ml-auto rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-sm font-medium text-gray-900 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">
						<option value="7">Last 7 days</option>
						<option value="14">Last 14 days</option>
						<option value="30">Last month</option>
						<option value="180">Last 6 months</option>
					</select>
							</div>
				</div>
				<div class="chart-body px-4 py-5 sm:p-6">
					<div id="eventsChart"></div>
					<div id="chartLegendOverlay" class="chart-legend-overlay" aria-hidden="true" data-state="empty"></div>
				</div>
			</section>
					<section>
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top teams
								<span class="ml-1 text-sm font-normal text-gray-500">(last 30 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 30 days.</p>
						</div>
						<div class="px-4 py-5 sm:p-6 text-left">
							<ul id="topTeamsList" class="top-users-list">
								<li class="top-users-empty">Loading top teams…</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-row-bottom">
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; flex: 1;">
					<section>
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top users
								<span class="ml-1 text-sm font-normal text-gray-500">(last 3 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 3 days.</p>
						</div>
						<div class="px-4 py-5 sm:p-6 text-left">
							<ul id="topUsersList" class="top-users-list">
								<li class="top-users-empty">Loading top users…</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg bg-white shadow-sm" id="serverStatsCard" style="text-align: left;">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Server stats</h3>
							<p class="mt-1 text-sm text-gray-500">Live telemetry server metrics.</p>
						</div>
						<div class="px-4 py-5 sm:p-6 text-left" style="display: flex; flex-direction: column; gap: 10px;">
							<ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px;">
								<li style="display: flex; justify-content: space-between; align-items: center;">
									<span style="color: var(--text-secondary);">Status</span>
									<span class="inline-flex items-center gap-x-1.5 rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800">
										<svg viewBox="0 0 6 6" aria-hidden="true" class="size-1.5 fill-green-500">
											<circle r="3" cx="3" cy="3" />
										</svg>
										Server is running
									</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Last updated</span>
									<span id="serverStatsLastUpdated" class="font-semibold">Loading...</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Load time</span>
									<span id="serverStatsLoadTime" class="font-semibold">-</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Version</span>
									<span id="serverStatsVersion" class="font-semibold">-</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">DB size</span>
									<span id="serverStatsDbSize" class="font-semibold">-</span>
								</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg bg-white shadow-sm">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Proposal tracker</h3>
							<p class="mt-1 text-sm text-gray-500">Keep track of your pitches.</p>
						</div>
						<div class="px-4 py-5 sm:p-6 text-left">
							<ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px;">
								<li><input type="checkbox" aria-label="Design project submitted" checked> Design Project · Last month</li>
								<li><input type="checkbox" aria-label="Video project submitted"> Video Project · Last week</li>
								<li>Copyright Project · 72% complete</li>
								<li>Web Design Project · 33% complete</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-footer">
				<a href="/health">Health Check</a> ·
				<a href="/api/events">API</a> ·
				<a href="/schema">Schema</a>
			</div>
		</div>
	</div>

	<script>
		// Load ECharts asynchronously to avoid blocking initial render
		(function () {
			const script = document.createElement('script');
			script.src = '/vendor/echarts/echarts.min.js';
			script.async = true;
			script.onload = function () {
				// Dispatch event when ECharts is loaded
				window.dispatchEvent(new CustomEvent('echartsLoaded'));
			};
			document.head.appendChild(script);
		})();
	</script>
	<script src="/js/navigation.js"></script>
	<script src="/js/user-menu.js"></script>
	<script src="/js/csrf-helper.js"></script>
	<script type="module" src="/js/index.js"></script>
</body>

</html>
