<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry Server</title>
	<link href="/css/output.css" rel="stylesheet">
	<style>
		:root {
			--bg-primary: #ffffff;
			--text-primary: #18181b;
			--text-secondary: #52525b;
			--brand-500: #0ea5e9;
			--brand-600: #0284c7;
		}

		html.dark {
			--bg-primary: #27272a;
			--text-primary: #e4e4e7;
			--text-secondary: #a1a1aa;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
			background: linear-gradient(135deg, #a8c0ff 0%, #b8a8ff 50%, #c8a8ff 100%);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 20px;
			position: relative;
		}

		body::before {
			content: '';
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background:
				radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
				radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
			pointer-events: none;
			z-index: 0;
		}

		html.dark {
			color-scheme: dark;
		}

		.container {
			position: relative;
			z-index: 10;
			text-align: center;
			max-width: 1000px;
			background: var(--bg-primary);
			padding: 60px 40px;
			border-radius: 16px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
		}

		html.dark .container {
			background: var(--bg-primary);
		}

		.chart-container {
			margin: 40px 0;
			position: relative;
			height: 300px;
		}

		.chart-title {
			font-size: 1.25rem;
			font-weight: 600;
			color: var(--text-primary);
			margin-bottom: 20px;
			text-align: left;
		}

		h1 {
			font-size: 2.5rem;
			font-weight: 700;
			color: var(--text-primary);
			margin-bottom: 16px;
		}

		p {
			font-size: 1.125rem;
			color: var(--text-secondary);
			margin-bottom: 40px;
			line-height: 1.6;
		}

		.event-log-link {
			display: inline-block;
			padding: 16px 32px;
			background: var(--brand-500);
			color: white;
			text-decoration: none;
			border-radius: 8px;
			font-size: 1.125rem;
			font-weight: 600;
			transition: background-color 0.2s ease, transform 0.15s ease;
			box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
		}

		.event-log-link:hover {
			background: var(--brand-600);
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(14, 165, 233, 0.4);
		}

		.event-log-link:active {
			transform: translateY(0);
		}

		.status-info {
			margin-top: 40px;
			padding-top: 40px;
			border-top: 1px solid #e4e4e7;
			font-size: 0.875rem;
			color: var(--text-secondary);
		}

		html.dark .status-info {
			border-color: #3f3f46;
		}

		.status-info a {
			color: var(--brand-500);
			text-decoration: none;
		}

		.status-info a:hover {
			text-decoration: underline;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>IBM Salesforce Context Telemetry Server</h1>
		<p>Welcome to the telemetry server for IBM Salesforce Context MCP server instances. Monitor and analyze telemetry events from your MCP server instances.</p>

		<div class="chart-container">
			<div class="chart-title">Events per day (last 30 days)</div>
			<canvas id="eventsChart"></canvas>
		</div>

		<a href="/event-log" class="event-log-link">Event log</a>
		<div class="status-info">
			<p>Server is running ✅</p>
			<p>
				<a href="/health">Health Check</a> •
				<a href="/api/events">API</a> •
				<a href="/schema">Schema</a>
			</p>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<script>
		// Detect system theme
		function getSystemTheme() {
			return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
		}

		function initTheme() {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || getSystemTheme();
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			} else {
				document.documentElement.classList.remove('dark');
			}
		}

		// Initialize theme
		initTheme();

		// Chart configuration
		let chart = null;

		async function loadChartData() {
			try {
				const response = await fetch('/api/daily-stats?days=30');
				const data = await response.json();

				const labels = data.map(item => {
					const date = new Date(item.date);
					return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
				});
				const counts = data.map(item => item.count);

				const isDark = document.documentElement.classList.contains('dark');
				const textColor = isDark ? '#a1a1aa' : '#52525b';
				const gridColor = isDark ? '#3f3f46' : '#e4e4e7';
				const borderColor = isDark ? '#0ea5e9' : '#0284c7';
				const backgroundColor = isDark ? 'rgba(14, 165, 233, 0.1)' : 'rgba(14, 165, 233, 0.1)';

				if (chart) {
					chart.destroy();
				}

				const ctx = document.getElementById('eventsChart').getContext('2d');
				chart = new Chart(ctx, {
					type: 'line',
					data: {
						labels: labels,
						datasets: [{
							label: 'Events',
							data: counts,
							borderColor: borderColor,
							backgroundColor: backgroundColor,
							borderWidth: 2,
							fill: true,
							tension: 0.4,
							pointRadius: 3,
							pointHoverRadius: 5,
							pointBackgroundColor: borderColor,
							pointBorderColor: '#ffffff',
							pointBorderWidth: 2
						}]
					},
					options: {
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
							legend: {
								display: false
							},
							tooltip: {
								backgroundColor: isDark ? '#27272a' : '#ffffff',
								titleColor: isDark ? '#e4e4e7' : '#18181b',
								bodyColor: isDark ? '#a1a1aa' : '#52525b',
								borderColor: gridColor,
								borderWidth: 1,
								padding: 12,
								displayColors: false,
								callbacks: {
									label: function(context) {
										return `Events: ${context.parsed.y}`;
									}
								}
							}
						},
						scales: {
							y: {
								beginAtZero: true,
								ticks: {
									color: textColor,
									font: {
										size: 12
									}
								},
								grid: {
									color: gridColor
								}
							},
							x: {
								ticks: {
									color: textColor,
									font: {
										size: 11
									},
									maxRotation: 45,
									minRotation: 45
								},
								grid: {
									color: gridColor,
									display: false
								}
							}
						}
					}
				});
			} catch (error) {
				console.error('Error loading chart data:', error);
			}
		}

		// Load chart on page load
		loadChartData();

		// Refresh chart every 30 seconds
		setInterval(loadChartData, 30000);
	</script>
</body>
</html>

