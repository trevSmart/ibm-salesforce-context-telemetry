<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>IBM Salesforce Context Telemetry</title>
	<link rel="icon" type="image/svg+xml" sizes="any" href="/resources/favicon.svg">
	<link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon.png">

	<!-- Preconnect to external domains for faster loading -->
	<link rel="preconnect" href="https://cdn.jsdelivr.net">

	<!-- Preload local Inter variable font and main stylesheet without blocking render -->
	<link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/css/output.css" as="style">
	<link rel="stylesheet" href="/css/output.css">

	<!-- Load FontAwesome asynchronously to prevent render blocking -->
	<link rel="preload" href="/vendor/fontawesome/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript><link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css"></noscript>
	<link rel="preload" href="/vendor/fontawesome/css/v4-shims.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript><link rel="stylesheet" href="/vendor/fontawesome/css/v4-shims.min.css"></noscript>
	<script src="/js/polyfills.js" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module" defer></script>
	<script>
		// Apply theme immediately before page render to prevent flash
		(function () {
			const savedTheme = localStorage.getItem('theme');
			const theme = savedTheme || 'light';
			if (theme === 'dark') {
				document.documentElement.classList.add('dark');
			}
			// Don't make container visible here - wait for chart to render
			// The container will be made visible when chart animation completes
			// Fallback: if chart doesn't load within 5 seconds, show page anyway
			setTimeout(() => {
				const container = document.querySelector('.container');
				if (container) {
					const computedStyle = window.getComputedStyle(container);
					if (computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
						container.style.visibility = 'visible';
						requestAnimationFrame(() => {
							container.style.opacity = '1';
						});
					}
				}
			}, 5000);
		})();
	</script>
</head>

<body class="index-page hydrating">
	<div class="container main-container">
		<div id="global-header-placeholder"></div>
		<script src="/js/header.js" defer></script>
		<script>
			// Initialize header for dashboard page after scripts are parsed
			window.addEventListener('DOMContentLoaded', () => {
				initGlobalHeader();
			});
		</script>
		<div class="container-content">
			<div class="dashboard-row-top">
				<div style="display: grid; grid-template-columns: 2.1fr 1fr; gap: 27px; align-items: stretch; height: 100%;">
			<section class="dashboard-chart-card overflow-hidden rounded-lg bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs h-full flex flex-col">
				<div class="chart-floating-header px-4 py-5 sm:px-6">
					<div class="chart-header" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 12px;">
						<div>
							<div id="chartLegendOverlay" class="chart-legend-overlay" aria-hidden="true" data-state="empty"></div>
							<h1 class="log-viewer-title" style="margin: 0 0 4px 0;">Dashboard</h1>
						</div>
					<label class="sr-only" for="timeRangeSelect">Select date range</label>
					<select id="timeRangeSelect" name="timeRangeSelect" data-floating-interactive
						class="block w-full sm:w-auto sm:ml-auto rounded-md bg-white dark:bg-white/5 border border-gray-300 dark:border-white/10 py-2 pl-3 pr-10 text-xs font-medium text-gray-900 dark:text-white focus:border-blue-300 dark:focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-500">
						<option value="7">Last 7 days</option>
						<option value="14">Last 14 days</option>
						<option value="30" selected>Last month</option>
						<option value="180">Last 6 months</option>
					</select>
							</div>
				</div>
				<div class="chart-body card-body px-4 pt-0 pb-5 sm:px-6 sm:pt-0 sm:pb-6">
					<div id="eventsChart"></div>
				</div>
			</section>
					<section class="rounded-lg shadow-xs bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top teams
								<span class="ml-1 text-sm font-normal text-gray-500">(last 30 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 30 days.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:pt-0 sm:pb-6 text-left">
							<ul id="topTeamsList" class="top-users-list">
								<li class="top-users-empty">Loading top teams…</li>
							</ul>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-row-bottom">
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 27px; flex: 1;">
					<section class="rounded-lg shadow-xs bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">
								Top users
								<span class="ml-1 text-sm font-normal text-gray-500">(last 14 days)</span>
							</h3>
							<p class="mt-1 text-sm text-gray-500">Sorted by event volume across the last 14 days.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:pt-0 sm:pb-6 text-left">
							<ul id="topUsersList" class="top-users-list">
								<li class="top-users-empty">Loading top users…</li>
							</ul>
						</div>
					</section>
					<section class="overflow-hidden rounded-lg bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs" id="serverStatsCard" style="text-align: left;">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Server stats</h3>
							<p class="mt-1 text-sm text-gray-500">Live telemetry server metrics.</p>
						</div>
						<!-- <div class="px-4 pt-0 pb-5 sm:px-6 sm:pt-0 sm:pb-6 text-left" style="display: flex; flex-direction: column; gap: 10px;">
							<ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px;">
								<li style="display: flex; justify-content: space-between; align-items: center;">
									<span style="color: var(--text-secondary);">Status</span>
									<span class="inline-flex items-center gap-x-1.5 rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800">
										<svg viewBox="0 0 6 6" aria-hidden="true" class="size-1.5 fill-green-500">
											<circle r="3" cx="3" cy="3" />
										</svg>
										Server is running
									</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Last updated</span>
									<span id="serverStatsLastUpdated" class="font-semibold">Loading...</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Load time</span>
									<span id="serverStatsLoadTime" class="font-semibold">-</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">Version</span>
									<span id="serverStatsVersion" class="font-semibold">-</span>
								</li>
								<li style="display: flex; justify-content: space-between; align-items: baseline;">
									<span style="color: var(--text-secondary);">DB size</span>
									<span id="serverStatsDbSize" class="font-semibold">-</span>
								</li>
							</ul>
						</div> -->
						<div class="card-body sm:px-6">
							<dl class="grid grid-cols-1 divide-gray-200 divide-y overflow-hidden">
							  <div class="py-2">
								<dt class="stats-title">Total Subscribers</dt>
								<dd class="mt-1 flex items-baseline justify-between md:block lg:flex">
								  <div class="flex items-baseline font-semibold text-indigo-600">
									71,897
									<span class="ml-2 text-sm font-medium text-gray-500">from 70,946</span>
								  </div>

								  <div class="inline-flex items-baseline rounded-full bg-green-100 px-2.5 py-0.5 text-sm font-medium text-green-800 md:mt-2 lg:mt-0">
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="mr-0.5 -ml-1 size-5 shrink-0 self-center text-green-500">
									  <path d="M10 17a.75.75 0 0 1-.75-.75V5.612L5.29 9.77a.75.75 0 0 1-1.08-1.04l5.25-5.5a.75.75 0 0 1 1.08 0l5.25 5.5a.75.75 0 1 1-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0 1 10 17Z" clip-rule="evenodd" fill-rule="evenodd" />
									</svg>
									<span class="sr-only"> Increased by </span>
									12%
								  </div>
								</dd>
							  </div>
							  <div class="py-2">
								<dt class="stats-title">Avg. Open Rate</dt>
								<dd class="mt-1 flex items-baseline justify-between md:block lg:flex">
								  <div class="flex items-baseline font-semibold text-indigo-600">
									58.16%
									<span class="ml-2 text-sm font-medium text-gray-500">from 56.14%</span>
								  </div>

								  <div class="inline-flex items-baseline rounded-full bg-green-100 px-2.5 py-0.5 text-sm font-medium text-green-800 md:mt-2 lg:mt-0">
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="mr-0.5 -ml-1 size-5 shrink-0 self-center text-green-500">
									  <path d="M10 17a.75.75 0 0 1-.75-.75V5.612L5.29 9.77a.75.75 0 0 1-1.08-1.04l5.25-5.5a.75.75 0 0 1 1.08 0l5.25 5.5a.75.75 0 1 1-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0 1 10 17Z" clip-rule="evenodd" fill-rule="evenodd" />
									</svg>
									<span class="sr-only"> Increased by </span>
									2.02%
								  </div>
								</dd>
							  </div>
							  <div class="py-2">
								<dt class="stats-title">Avg. Click Rate</dt>
								<dd class="mt-1 flex items-baseline justify-between md:block lg:flex">
								  <div class="flex items-baseline font-semibold text-indigo-600">
									24.57%
									<span class="ml-2 text-sm font-medium text-gray-500">from 28.62%</span>
								  </div>

								  <div class="inline-flex items-baseline rounded-full bg-red-100 px-2.5 py-0.5 text-sm font-medium text-red-800 md:mt-2 lg:mt-0">
									<svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="mr-0.5 -ml-1 size-5 shrink-0 self-center text-red-500">
									  <path d="M10 3a.75.75 0 0 1 .75.75v10.638l3.96-4.158a.75.75 0 1 1 1.08 1.04l-5.25 5.5a.75.75 0 0 1-1.08 0l-5.25-5.5a.75.75 0 1 1 1.08-1.04l3.96 4.158V3.75A.75.75 0 0 1 10 3Z" clip-rule="evenodd" fill-rule="evenodd" />
									</svg>
									<span class="sr-only"> Decreased by </span>
									4.05%
								  </div>
								</dd>
							  </div>
							</>
						  </div>

					</section>
					<section class="overflow-hidden rounded-lg bg-white dark:bg-gray-800/50 dark:outline dark:-outline-offset-1 dark:outline-white/10 shadow-xs">
						<div class="px-4 py-5 sm:px-6">
							<h3 class="text-base font-semibold text-gray-900">Tool usage</h3>
							<p class="mt-1 text-sm text-gray-500">Keep track of your tool usage.</p>
						</div>
						<div class="card-body px-4 pt-0 pb-5 sm:px-6 sm:pt-0 sm:pb-6 text-left">
							<div id="toolUsageChart" style="width: 100%; height: 220px;"></div>
						</div>
					</section>
				</div>
			</div>
			<div class="dashboard-footer">
				<a href="/health">Health check</a> ·
				<a href="/api/events">API</a> ·
				<a href="/schema">Schema</a>
			</div>
		</div>
	</div>

	<script>
		// Load ECharts asynchronously to avoid blocking initial render
		(function () {
			const script = document.createElement('script');
			script.src = '/vendor/echarts/echarts.min.js';
			script.async = true;
			script.onload = function () {
				// Dispatch event when ECharts is loaded
				window.dispatchEvent(new CustomEvent('echartsLoaded'));
			};
			document.head.appendChild(script);
		})();
	</script>
	<script src="/js/navigation.js" defer></script>
	<script src="/js/user-menu.js" defer></script>
	<script src="/js/csrf-helper.js" defer></script>
	<script src="/js/settings-modal.js" defer></script>
	<script type="module" src="/js/index.js" defer></script>
	<script type="module" src="/js/tool-usage-chart.js" defer></script>
</body>

</html>
