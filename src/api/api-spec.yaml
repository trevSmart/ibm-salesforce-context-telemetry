openapi: 3.0.3
info:
  title: IBM Salesforce Context Telemetry API
  description: |
    API specification for the IBM Salesforce Context Telemetry Server.
    This API receives telemetry events from MCP server instances.
    Supports both schema v1 (legacy) and v2 (current) formats for maximum compatibility.
  version: 1.2.0
  contact:
    name: IBM Salesforce Context Team
    url: https://github.com/trevSmart/ibm-salesforce-context-telemetry

servers:
  - url: https://ibm-salesforce-context-telemetry.onrender.com
    description: Production server
  - url: http://localhost:3100
    description: Local development server

paths:
  /telemetry:
    post:
      summary: Send telemetry event
      description: |
        Receives telemetry events from MCP server instances.
        Supports both schema v1 (legacy) and v2 (current) formats.
        Events are logged and can be stored for analytics purposes.
      operationId: sendTelemetry
      tags:
        - Telemetry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelemetryEvent'
            examples:
              toolCall:
                summary: Tool call event
                value:
                  event: tool_call
                  timestamp: "2024-01-15T10:30:00.000Z"
                  serverId: "server-instance-123"
                  version: "1.0.0"
                  data:
                    toolName: execute_queries_and_dml
                    operation: query
                    duration: 150
                    success: true
              toolError:
                summary: Tool error event
                value:
                  event: tool_error
                  timestamp: "2024-01-15T10:30:00.000Z"
                  serverId: "server-instance-123"
                  version: "1.0.0"
                  data:
                    toolName: describe_object
                    errorType: ValidationError
                    errorMessage: Invalid object name
                    success: false
              sessionStart:
                summary: Session start event (v1 schema)
                value:
                  event: session_start
                  timestamp: "2024-01-15T10:30:00.000Z"
                  serverId: "server-instance-123"
                  version: "1.0.0"
                  data:
                    transport: stdio
                    clientVersion: "1.0.0"
              v2ToolCall:
                summary: Tool call event (v2 schema)
                value:
                  schemaVersion: 2
                  area: tool
                  event: execution
                  success: true
                  timestamp: "2024-01-15T10:30:00.000Z"
                  server:
                    id: "server-instance-123"
                    version: "1.0.0"
                    capabilities: {}
                  client:
                    name: "Cursor"
                    version: "1.0.0"
                    capabilities: {}
                  session:
                    id: "session-456"
                    transport: "stdio"
                    protocolVersion: "2025-11-25"
                  user:
                    id: "user-789"
                  data:
                    toolName: execute_queries_and_dml
                    operation: query
                    duration: 150
              v2ToolError:
                summary: Tool error event (v2 schema)
                value:
                  schemaVersion: 2
                  area: tool
                  event: execution
                  success: false
                  timestamp: "2024-01-15T10:30:00.000Z"
                  server:
                    id: "server-instance-123"
                    version: "1.0.0"
                    capabilities: {}
                  session:
                    id: "session-456"
                    transport: "stdio"
                    protocolVersion: "2025-11-25"
                  user:
                    id: "user-789"
                  data:
                    toolName: describe_object
                    errorType: ValidationError
                    errorMessage: Invalid object name
                    duration: 50
              v2SessionStart:
                summary: Session start event (v2 schema)
                value:
                  schemaVersion: 2
                  area: session
                  event: session_start
                  success: true
                  timestamp: "2024-01-15T10:30:00.000Z"
                  server:
                    id: "server-instance-123"
                    version: "1.0.0"
                    capabilities: {}
                  session:
                    id: "session-456"
                    transport: "stdio"
                    protocolVersion: "2025-11-25"
                  data:
                    transport: stdio
              v2ServerBoot:
                summary: Server boot event (v2 schema)
                description: Note that client field is omitted since no client has connected yet at server boot time
                value:
                  schemaVersion: 2
                  area: session
                  event: server_boot
                  success: true
                  timestamp: "2024-01-15T10:29:00.000Z"
                  server:
                    id: "server-instance-123"
                    version: "1.0.0"
                    capabilities: {}
                  session:
                    id: null
                    transport: "stdio"
                    protocolVersion: "2025-11-25"
                  data:
                    transport: stdio
                    port: null
      responses:
        '200':
          description: Telemetry event received successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelemetryResponse'
              example:
                status: ok
                receivedAt: "2024-01-15T10:30:00.123Z"
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid telemetry data
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /health:
    get:
      summary: Health check
      description: |
        Simple health check endpoint for monitoring and load balancers.
        Returns "ok" if the server is operational.
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Server is healthy
          content:
            text/plain:
              schema:
                type: string
                example: ok

  /:
    get:
      summary: Server status
      description: Root endpoint that returns server status message.
      operationId: getStatus
      tags:
        - Status
      responses:
        '200':
          description: Server is running
          content:
            text/plain:
              schema:
                type: string
                example: MCP Telemetry server is running âœ…

components:
  schemas:
    TelemetryEvent:
      type: object
      required:
        - event
        - timestamp
      properties:
        event:
          type: string
          description: Type of telemetry event
          enum:
            - tool_call
            - tool_error
            - session_start
            - session_end
            - error
            - custom
          example: tool_call
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the event occurred
          example: "2024-01-15T10:30:00.000Z"
        serverId:
          type: string
          description: Unique identifier for the MCP server instance
          example: "server-instance-123"
        version:
          type: string
          description: Version of the MCP server
          example: "1.0.0"
        sessionId:
          type: string
          description: Unique identifier for the MCP session
          example: "session-abc-123"
        userId:
          type: string
          description: Anonymous user identifier (no PII)
          example: "user-anon-456"
        data:
          type: object
          description: Event-specific data payload
          additionalProperties: true
          properties:
            toolName:
              type: string
              description: Name of the tool that was called
              example: execute_queries_and_dml
            success:
              type: boolean
              description: Whether the operation was successful
            duration:
              type: integer
              description: Duration of the operation in milliseconds
              example: 150
            errorType:
              type: string
              description: Type of error (if applicable)
            errorMessage:
              type: string
              description: Error message (if applicable)
          example:
            toolName: execute_queries_and_dml
            operation: query
            duration: 150
            success: true

    TelemetryResponse:
      type: object
      properties:
        status:
          type: string
          enum: [ok]
          example: ok
        receivedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the event was received by the server
          example: "2024-01-15T10:30:00.123Z"

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
          example: error
        message:
          type: string
          description: Error message describing what went wrong
          example: Invalid telemetry data

  securitySchemes: {}
